<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MT940 Viewer</title>
    <style>
        body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; background:#f6f7f9; }
        header { background: #1f6feb; color: #fff; padding: 16px 24px; }
        main { max-width: 980px; margin: 24px auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        h1 { margin: 0; font-size: 20px; }
        form textarea { width: 100%; min-height: 200px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 13px; padding: 12px; border-radius: 6px; border: 1px solid #d0d7de; box-sizing: border-box; }
        .actions { margin-top: 12px; display: flex; gap: 8px; align-items: center; }
        .btn { background: #1f6feb; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
        .btn:disabled { opacity: .6; cursor: not-allowed; }
        .grid { display: grid; grid-template-columns: 180px 1fr; gap: 8px 16px; margin: 16px 0; }
        .muted { color: #57606a; }
        table { border-collapse: collapse; width: 100%; }
        th, td { padding: 10px 8px; border-bottom: 1px solid #eef1f4; text-align: left; }
        th { background: #f6f8fa; font-weight: 600; }
        .tag { display:inline-block; padding:2px 6px; border-radius:4px; font-size:12px; }
        .credit { color: #116329; }
        .debit { color: #a40e26; }
        .totals { display:flex; gap:24px; margin-top: 8px; }
        .card { border:1px solid #eaeef2; padding:12px; border-radius:6px; background:#fafbfc; }
        footer { text-align:center; color:#8c959f; padding: 16px; }
        .help { font-size: 13px; color: #59636e; }
    </style>
    <script>
        function pasteExample() {
            const example = `:20:REF12345\n:25:DE89370400440532013000\n:28C:00001/001\n:60F:C240101EUR0,00\n:61:240101D123,45NTRFNONREF\n:86:GROCERY STORE - ANYTOWN\n:61:240102C999,99NTRFSALARY\n:86:ACME CORP SALARY PAYMENT\n:62F:C240131EUR876,54`;
            document.getElementById('mt940').value = example;
        }
    </script>
    </head>
<body>
<header>
    <h1>MT940 Transactions Viewer</h1>
    <div class="help">Paste an MT940 message to see a friendly statement details page.</div>
    </header>
<main>
    <form method="post" action="/parse">
        <label for="mt940" class="muted">MT940 Message</label>
        <textarea id="mt940" name="mt940" placeholder=":20:..." required></textarea>
        <div class="actions">
            <button type="submit" class="btn">Parse</button>
            <button type="button" class="btn" onclick="pasteExample()">Paste example</button>
        </div>
    </form>

    <div th:if="${statement != null}">
        <h2>Statement details</h2>
        <div class="grid">
            <div class="muted">Transaction reference (:20:)</div>
            <div th:text="${statement.transactionReference}">REF</div>
            <div class="muted">Account (:25:)</div>
            <div th:text="${statement.account}">IBAN</div>
            <div class="muted">Statement number (:28C:)</div>
            <div th:text="${statement.statementNumber}">00001/001</div>
            <div class="muted">Opening balance (:60F:)</div>
            <div>
                <span th:if="${statement.openingBalance != null}">
                    <span th:classappend="${statement.openingBalance.credit} ? 'credit' : 'debit'" 
                          th:text="${statement.openingBalance.type}">Credit</span>
                    <span th:text="${statement.openingBalance.date}">2025-11-03</span>
                    <strong th:text="${statement.openingBalance.formattedAmount}">USD 0.00</strong>
                </span>
            </div>
            <div class="muted">Closing balance (:62F:)</div>
            <div>
                <span th:if="${statement.closingBalance != null}">
                    <span th:classappend="${statement.closingBalance.credit} ? 'credit' : 'debit'" 
                          th:text="${statement.closingBalance.type}">Credit</span>
                    <span th:text="${statement.closingBalance.date}">2025-11-03</span>
                    <strong th:text="${statement.closingBalance.formattedAmount}">USD 1000.30</strong>
                </span>
            </div>
        </div>

        <div class="totals">
            <div class="card"><strong>Total credits:</strong>
                <span class="credit" th:text="${#numbers.formatDecimal(statement.totalCredits,1,'COMMA',2,'POINT')}">0.00</span>
            </div>
            <div class="card"><strong>Total debits:</strong>
                <span class="debit" th:text="${#numbers.formatDecimal(statement.totalDebits,1,'COMMA',2,'POINT')}">0.00</span>
            </div>
        </div>

        <h3>Transactions</h3>
        <table>
            <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Description</th>
                <th style="text-align:right">Amount</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="t : ${statement.transactions}">
                <td th:text="${t.date}">2024-01-01</td>
                <td><span class="tag" th:text="${t.credit} ? 'Credit' : 'Debit'" th:classappend=" ${t.credit} ? 'credit' : 'debit'"></span></td>
                <td th:text="${t.description}">Description</td>
                <td style="text-align:right" th:text="${t.amount}">0.00</td>
            </tr>
            <tr th:if="${#lists.isEmpty(statement.transactions)}"><td colspan="4" class="muted">No transactions found</td></tr>
            </tbody>
        </table>
    </div>
    <div th:if="${statement == null}">
        <p class="muted">Submit the form above to see parsed results here.</p>
    </div>
    </main>
<footer>
    MT940 viewer â€¢ simple monolith demo
    </footer>
</body>
</html>
